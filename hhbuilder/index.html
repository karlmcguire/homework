<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Household builder</title>
        <style>
            .debug {
                font-family: monospace;
                border: 1px solid black;
                padding: 10px;
                display: none;
            }
        </style>
    </head>
    <body>
        <h1>Household builder</h1>
        <div class="builder">
            <ol class="household"></ol>
            <form>
                <div>
                    <label>Age
                        <input type="text" name="age">
                    </label>
                </div>
                <div>
                    <label>Relationship
                        <select name="rel">
                            <option value="">---</option>
                            <option value="self">Self</option>
                            <option value="spouse">Spouse</option>
                            <option value="child">Child</option>
                            <option value="parent">Parent</option>
                            <option value="grandparent">Grandparent</option>
                            <option value="other">Other</option>
                        </select>
                    </label>
                </div>
                <div>
                    <label>Smoker?
                        <input type="checkbox" name="smoker">
                    </label>
                </div>
                <div>
                    <button class="add">add</button>
                </div>
                <div>
                    <button type="submit">submit</button>
                </div>
            </form>
        </div>
        <pre class="debug"></pre>
        <script>
			var household = new function() {
				this.members = [];
				this.selfAdded = false;
			
				this.addMember = function(list, age, relationship, smoker) {
					if(relationship == "self") {
						if(household.selfAdded) {
							alert("You already added yourself.");
							return;
						} else {
							household.selfAdded = true;
						}
					}

					var index = household.members.length;
					
					household.members = household.members.concat(
						{
							"age": age, 
							"rel": relationship, 
							"smoker": smoker
						}
					);

					var li = document.createElement("li");
					li.setAttribute("id", index);

					var del = document.createElement("button");
					del.setAttribute("onclick", "household.delMember(" + index + ")");	
					del.innerText = "Delete";

					var smokeText = "";
					if(smoker) {
						smokeText = ", smoker";
					}

					var person = document.createTextNode(relationship + ", " + age + smokeText);
					li.appendChild(del);
					li.appendChild(person);
					list.appendChild(li);
				};

				this.delMember = function(index) {
					if(household.members[index]["rel"] == "self") {
						household.selfAdded = false;
					}

					delete household.members[index];	

					var list = document.getElementsByClassName("household")[0];
					list.removeChild(document.getElementById(index));
				};
			};

       		window.onload = function() {
				var debug = document.getElementsByClassName("debug")[0];
				var add = document.getElementsByClassName("add")[0];
				var list = document.getElementsByClassName("household")[0];
				
				var form = document.getElementsByTagName("form")[0];
				var formRel = document.getElementsByName("rel")[0];
				var formSmoker = document.getElementsByName("smoker")[0];
				var formAge = document.getElementsByName("age")[0];

				form.addEventListener("submit", function(e) {	
					e.preventDefault();

					if(!household.selfAdded) {
						alert("You need to add yourself before submitting.");
						return;
					}

					var packed = [];
					
					for(i = 0; i < household.members.length; i++) {
						if(household.members[i] != null) {
							packed = packed.concat(household.members[i]);	
						}
					}

					debug.style.display = "block";	
					debug.innerText = JSON.stringify(packed, null, '    ');
				});

				add.addEventListener("click", function(e) {
					e.preventDefault();

					// Validate inputs.
					if(formAge.value == "") {
						alert("Age is required.");
						return;
					}
					if(formAge.value == "0") {
						alert("Age must be greater than 0.");
						return;
					}
					if(formRel.value == "") {
						alert("Relationship is required.");
						return;
					}
				
					household.addMember(list, formAge.value, formRel.value, formSmoker.checked);

					formAge.value = "";
					formRel.value = "";
					formSmoker.checked = false;
				});
			};
		</script>
    </body>
</html>
